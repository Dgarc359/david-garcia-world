"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9710],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=p(n),d=r,h=u["".concat(s,".").concat(d)]||u[d]||c[d]||o;return n?a.createElement(h,i(i({ref:t},m),{},{components:n})):a.createElement(h,i({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5943:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const o={},i=void 0,l={unversionedId:"General/Random/Graphs/Gremlin/gremlin",id:"General/Random/Graphs/Gremlin/gremlin",title:"gremlin",description:"Set up Gremlin Console",source:"@site/docs/General/Random/Graphs/Gremlin/gremlin.md",sourceDirName:"General/Random/Graphs/Gremlin",slug:"/General/Random/Graphs/Gremlin/",permalink:"/book/index.html/docs/General/Random/Graphs/Gremlin/",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/General/Random/Graphs/Gremlin/gremlin.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"fundamentals",permalink:"/book/index.html/docs/General/Programming-Languages/fundamentals/"},next:{title:"graph",permalink:"/book/index.html/docs/General/Random/Graphs/graph"}},s={},p=[{value:"Set up Gremlin Console",id:"set-up-gremlin-console",level:4},{value:"Set up Empty Graph",id:"set-up-empty-graph",level:4},{value:"Load Sample Data into console",id:"load-sample-data-into-console",level:4},{value:"Locating a specific vertex",id:"locating-a-specific-vertex",level:5},{value:"Notes on valuemap / elementmap",id:"notes-on-valuemap--elementmap",level:5},{value:"More Queries",id:"more-queries",level:5},{value:"Using Gremlin on AWS Jupyter notebooks",id:"using-gremlin-on-aws-jupyter-notebooks",level:4},{value:"AWS Gremlin Implementation differences",id:"aws-gremlin-implementation-differences",level:4},{value:"Connect console to AWS Neptune",id:"connect-console-to-aws-neptune",level:4},{value:"Gremlin Jargon",id:"gremlin-jargon",level:4}],m={toc:p};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h4",{id:"set-up-gremlin-console"},"Set up Gremlin Console"),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"set-up-empty-graph"},"Set up Empty Graph"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"graph = TinkerGraph.open()"),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"g = traversal().withEmbedded(graph)")),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"load-sample-data-into-console"},"Load Sample Data into console"),(0,r.kt)("p",null,"Start gremlin console: ",(0,r.kt)("inlineCode",{parentName:"p"},"bin/gremlin.sh")),(0,r.kt)("p",null,'Loading up the "Modern Graph"\n-> Insert picture of graph <-\n',(0,r.kt)("inlineCode",{parentName:"p"},"graph = TinkerFactory.createModern()")),(0,r.kt)("p",null,"Creating a TraversalSource\n",(0,r.kt)("inlineCode",{parentName:"p"},"g = traversal().withEmbedded(graph)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"- Provides traversal strategies to appli and the traversal engine to use\n")),(0,r.kt)("p",null,"Info on ",(0,r.kt)("inlineCode",{parentName:"p"},"withEmbedded()"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://tinkerpop.apache.org/docs/3.5.1/reference/#connecting-embedded"},"https://tinkerpop.apache.org/docs/3.5.1/reference/#connecting-embedded")),(0,r.kt)("p",null,"Traversing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"g.V() //// (1)\ng.V(1) //// (2)\ng.V(1).values('name') //// (3)\ng.V(1).outE('knows') //// (4)\ng.V(1).outE('knows').inV().values('name') //// (5)\ng.V(1).out('knows').values('name') //// (6)\ng.V(1).out('knows').has('age', gt(30)).values('name')    // (7)\n")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Get all vertices in the Graph"),(0,r.kt)("li",{parentName:"ol"},"Get the vertex with unique id of '1'"),(0,r.kt)("li",{parentName:"ol"},"Get the value of the ",(0,r.kt)("inlineCode",{parentName:"li"},"name")," property on the vertex with unique id '1'"),(0,r.kt)("li",{parentName:"ol"},'Get the edges with the label "knows" for the vertex with the unique id of "1"'),(0,r.kt)("li",{parentName:"ol"},'Get the names of the people whom the vertex with the unique id "1" "knows"'),(0,r.kt)("li",{parentName:"ol"},"Note: when using ",(0,r.kt)("inlineCode",{parentName:"li"},"outE().inV()")," as shown in 5, this can be shortened to just ",(0,r.kt)("inlineCode",{parentName:"li"},"out()")," similar to ",(0,r.kt)("inlineCode",{parentName:"li"},"inE().outV()")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"in()")," for incoming edges"),(0,r.kt)("li",{parentName:"ol"},"Get the names of the people vertex '1' knows, IF they are over age 30")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"IMPORTANT"),"\nA Traversal is an iterator, if you assign a variable to something like ",(0,r.kt)("inlineCode",{parentName:"p"},"x = g.V()")," you will need to iterate over ",(0,r.kt)("inlineCode",{parentName:"p"},"x")," yourself, the gremlin console automatically does this for you"),(0,r.kt)("h5",{id:"locating-a-specific-vertex"},"Locating a specific vertex"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"g.V().has('person', 'name', 'marko')"),"\nHere, gremlin is iterating through all vertexes and locating a 'person' vertex that has the property 'name' with value 'marko'"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"IMPORTANT"),"\nLocating a vertex in this fashion works for sample Databases, but more complex databases with millions or billions of vertices are going to be a bigger problem for this method. Gremlin recommends consulting documentation of the graph / graph db you have chose and utilize its native API to create indices which will then speed up these types of lookups."),(0,r.kt)("h5",{id:"notes-on-valuemap--elementmap"},"Notes on valuemap / elementmap"),(0,r.kt)("p",null,"It may be more useful to use ",(0,r.kt)("inlineCode",{parentName:"p"},"by(__.identity())")," over ",(0,r.kt)("inlineCode",{parentName:"p"},"by(elementMap())")),(0,r.kt)("h5",{id:"more-queries"},"More Queries"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"g.V().groupCount().by(label).unfold()")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"console\n\n{'continent': 7}\n{'country': 237}\n{'version': 1}\n{'airport': 3502}\n\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"g.E().groupCount().by(label).unfold()")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{'contains': 7004}\n{'route': 50656}\n")),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"using-gremlin-on-aws-jupyter-notebooks"},"Using Gremlin on AWS Jupyter notebooks"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'%%graph_notebook_config\n{\n  "host": "localhost",\n  "port": 8182,\n  "ssl": false\n}\n')),(0,r.kt)("p",null,"Set notebook config"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"%seed")," to set up sample data"),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"aws-gremlin-implementation-differences"},"AWS Gremlin Implementation differences"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/neptune/latest/userguide/access-graph-gremlin-differences.html"},"https://docs.aws.amazon.com/neptune/latest/userguide/access-graph-gremlin-differences.html")),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"connect-console-to-aws-neptune"},"Connect console to AWS Neptune"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/neptune/latest/userguide/access-graph-gremlin-console.html"},"https://docs.aws.amazon.com/neptune/latest/userguide/access-graph-gremlin-console.html")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"sudo yum install java-1.8.0-devel")," install java 8"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"sudo /usr/sbin/alternatives --config java")," set java 8 as default"),(0,r.kt)("li",{parentName:"ol"},"Install gremlin console"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"wget https://www.amazontrust.com/repository/SFSRootCAG2.cer")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"mkdir /tmp/certs/")),(0,r.kt)("li",{parentName:"ol"},"Find JRE path like so:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ls -l /usr/bin/java")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ls -l <symlink of last command>")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"cp jre_path/lib/security/cacerts /tmp/certs/cacerts")),(0,r.kt)("li",{parentName:"ol"},"Run the following in console")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo keytool -importcert \\\n             -alias neptune-tests-ca \\\n             -keystore /tmp/certs/cacerts \\\n             -file  /home/ec2-user/apache-tinkerpop-gremlin-console-3.4.8/SFSRootCAG2.cer \\\n             -noprompt \\\n             -storepass changeit\n")),(0,r.kt)("ol",{start:9},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"cd <gremlin-console>/conf")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("inlineCode",{parentName:"li"},"touch neptune-remote.yaml")),(0,r.kt)("li",{parentName:"ol"},"vim edit ",(0,r.kt)("inlineCode",{parentName:"li"},"neptune-remote.yaml")," with the following:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"hosts: [your-neptune-endpoint]\nport: 8182\nconnectionPool: { enableSsl: true,  trustStore: /tmp/certs/cacerts }\nserializer: { className: org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerV3d0, config: { serializeResultToString: true }}```\n")))),(0,r.kt)("hr",null),(0,r.kt)("h4",{id:"gremlin-jargon"},"Gremlin Jargon"),(0,r.kt)("p",null,'"step modulator"'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\n---\n\nWorking with airport sample data\n\n**Find all vertex labels:** `g.V().label().dedup()`\ndedup makes sure we get a list of unique label names back\n\n**Find all edge labels:** `g.E().label().dedup()`\n\n**Find vertex properties:** `g.V().hasLabel('airport').limit(1).next().keys()`\n\n---\n\n**Airports with the most routes?**\n`g.V().hasLabel('airport').where(out('route').count().is(gt(180))).group().by('code').by(out().count()).order(local).by(values,desc)`\n\n**What is the distribution of runways in the graph?**\n`g.V().hasLabel('airport').groupCount().by('runways')`\n\n**Does any route exist between two airports?**\n`g.V().has('code','AUS').repeat(out().dedup()).until(has('code','YPO')).path().by('code')`\n\n**What airports in the US / Canada can I fly to from india?**\n`g.V().has('country','code','IN').out().out().has('country',within('US','CA')).path().by('code')`\n\nwe can fold this and make it an array\n\n**Find all the routes between cities x, y, and z**\n`g.V().has('city', within('London','Munich','Paris')).aggregate('a').out().where(within('a')).path().by('code')`\n\n`g.V().has('city', within('Miami','Atlanta','Paris')).aggregate('a').out().where(within('a')).path().by('code')`\n\n---\n\n`g.V().label().dedup()`\n\n**Find weights and vertices associated with vertex**\n`g.V().has('name','marko').bothE().otherV().path().by(__.valueMap(true))`\n\nrepresent our data for a given time period =, all of the user data \n\n** Add Property to a vertex **\nhttps://stackoverflow.com/questions/34648009/how-to-add-property-to-vertex-property-in-java\n\n---\nreferences\n\n\n---\n\n#### Documentation\n<a href=\"https://tinkerpop.apache.org/docs/current/reference/\"> TinkerPop Gremlin Docs </a>\n\n<a href=\"https://tinkerpop.apache.org/docs/current/reference/#gremlin-javascript-imports\"> Javascript common imports </a>\n\n---\n#### Unsorted but important\nhttps://tinkerpop.apache.org/docs/current/tutorials/getting-started/\n\nhttps://tinkerpop.apache.org/docs/current/tutorials/the-gremlin-console/\n\nhttps://github.com/bricaud/graphexp#:~:text=Graphexp%20is%20a%20lightweight%20web,required%2C%20see%20issue%20%23102.\n\nhttps://gdotv.com/\n\nhttps://kelvinlawrence.net/book/Gremlin-Graph-Guide.html\n\nhttps://tinkerpop.apache.org/docs/3.5.1/reference/#connecting-gremlin\n\nhttps://tinkerpop.apache.org/docs/3.5.1/reference/#javascript-imports\n\nhttps://stackoverflow.com/questions/7362278/get-the-id-the-map-of-a-vertex-on-gremlin\n\n\n---\n#### Visualization libraries\nhttps://visjs.org/cyt\nhttps://visjs.github.io/vis-network/examples/\n\nhttps://js.cytoscape.org/\n\nhttps://docs.aws.amazon.com/neptune/latest/userguide/full-text-search-gremlin.html\n\n\n---\n#### StackOverflow\n<ul>\n    <li> <a href=\"https://stackoverflow.com/questions/49987829/gremlin-find-all-connected-vertices\"> Find all connected vertices </a> </li>\n</ul>\n")))}c.isMDXComponent=!0}}]);